<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø´Ø§Ù…Ù„ Ù„Ù„Ù†Ø¸Ø§Ù… - Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¥Ø³ÙƒØ§Ù† Ø§Ù„Ø¬Ø§Ù…Ø¹ÙŠ</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Tajawal', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3a5f 0%, #2c5282 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #1e3a5f 0%, #2c5282 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .nav-tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #dee2e6;
            padding: 0 30px;
            overflow-x: auto;
        }

        .nav-tab {
            padding: 15px 25px;
            cursor: pointer;
            border: none;
            background: transparent;
            font-size: 1.1em;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
            white-space: nowrap;
        }

        .nav-tab:hover {
            background: rgba(102, 126, 234, 0.1);
        }

        .nav-tab.active {
            background: white;
            border-bottom-color: #1e3a5f;
            color: #1e3a5f;
            font-weight: bold;
        }

        .content {
            padding: 30px;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .kpi-card {
            background: linear-gradient(135deg, #1e3a5f 0%, #2c5282 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
            transition: transform 0.3s;
        }

        .kpi-card:hover {
            transform: translateY(-5px);
        }

        .kpi-value {
            font-size: 2.5em;
            font-weight: bold;
            margin: 10px 0;
        }

        .kpi-label {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .chart-container {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }

        .chart-title {
            font-size: 1.5em;
            color: #1e3a5f;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .stats-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .stats-table th,
        .stats-table td {
            padding: 12px;
            text-align: center;
            border-bottom: 1px solid #dee2e6;
        }

        .stats-table th {
            background: #1e3a5f;
            color: white;
            font-weight: bold;
        }

        .stats-table tr:hover {
            background: #f8f9fa;
        }

        .print-btn {
            background: #28a745;
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            cursor: pointer;
            margin: 20px auto;
            display: block;
            transition: all 0.3s;
        }

        .print-btn:hover {
            background: #218838;
            transform: scale(1.05);
        }

        .loading {
            text-align: center;
            padding: 50px;
            font-size: 1.5em;
            color: #1e3a5f;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 20px;
            border-radius: 8px;
            margin: 20px;
            text-align: center;
        }

        @media print {
            body {
                background: white;
                padding: 0;
            }

            .nav-tabs,
            .print-btn {
                display: none;
            }

            .tab-content {
                display: block !important;
                page-break-after: always;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“Š Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø´Ø§Ù…Ù„ Ù„Ù„Ù†Ø¸Ø§Ù…</h1>
            <p>Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø¥Ø³ÙƒØ§Ù† Ø£Ø¹Ø¶Ø§Ø¡ Ù‡ÙŠØ¦Ø© Ø§Ù„ØªØ¯Ø±ÙŠØ³ - Ø¬Ø§Ù…Ø¹Ø© Ø§Ù„Ø¥Ù…Ø§Ù… Ù…Ø­Ù…Ø¯ Ø¨Ù† Ø³Ø¹ÙˆØ¯ Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ÙŠØ©</p>
            <p id="report-date"></p>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showTab('overview')">Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©</button>
            <button class="nav-tab" onclick="showTab('buildings')">Ø§Ù„Ù…Ø¨Ø§Ù†ÙŠ</button>
            <button class="nav-tab" onclick="showTab('units')">Ø§Ù„ÙˆØ­Ø¯Ø§Øª</button>
            <button class="nav-tab" onclick="showTab('residents')">Ø§Ù„Ø³ÙƒØ§Ù†</button>
            <button class="nav-tab" onclick="showTab('parking')">Ø§Ù„Ù…ÙˆØ§Ù‚Ù</button>
            <button class="nav-tab" onclick="showTab('stickers')">Ø§Ù„Ù…Ù„ØµÙ‚Ø§Øª</button>
        </div>

        <div class="content">
            <div id="loading" class="loading">
                Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...
            </div>

            <div id="error" class="error" style="display: none;"></div>

            <!-- Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø© -->
            <div id="overview" class="tab-content active">
                <h2 style="color: #1e3a5f; margin-bottom: 20px;">ğŸ“ˆ Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© (KPIs)</h2>
                <div class="kpi-grid" id="kpi-grid"></div>

                <div class="chart-container">
                    <div class="chart-title">ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</div>
                    <canvas id="overviewChart"></canvas>
                </div>
            </div>

            <!-- Ø§Ù„Ù…Ø¨Ø§Ù†ÙŠ -->
            <div id="buildings" class="tab-content">
                <h2 style="color: #1e3a5f; margin-bottom: 20px;">ğŸ¢ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø¨Ø§Ù†ÙŠ Ø§Ù„ØªÙØµÙŠÙ„ÙŠ</h2>
                <div class="chart-container">
                    <div class="chart-title">ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…Ø¨Ø§Ù†ÙŠ Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹</div>
                    <canvas id="buildingsChart"></canvas>
                </div>
                <div class="chart-container">
                    <div class="chart-title">Ø£ÙƒØ«Ø± 10 Ù…Ø¨Ø§Ù†ÙŠ Ù…Ù† Ø­ÙŠØ« Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù„ØµÙ‚Ø§Øª</div>
                    <canvas id="topBuildingsChart"></canvas>
                </div>
            </div>

            <!-- Ø§Ù„ÙˆØ­Ø¯Ø§Øª -->
            <div id="units" class="tab-content">
                <h2 style="color: #1e3a5f; margin-bottom: 20px;">ğŸ  ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙˆØ­Ø¯Ø§Øª Ø§Ù„Ø³ÙƒÙ†ÙŠØ©</h2>
                <div class="chart-container">
                    <div class="chart-title">Ø­Ø§Ù„Ø© Ø¥Ø´ØºØ§Ù„ Ø§Ù„ÙˆØ­Ø¯Ø§Øª</div>
                    <canvas id="unitsChart"></canvas>
                </div>
                <div id="units-stats"></div>
            </div>

            <!-- Ø§Ù„Ø³ÙƒØ§Ù† -->
            <div id="residents" class="tab-content">
                <h2 style="color: #1e3a5f; margin-bottom: 20px;">ğŸ‘¥ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø³ÙƒØ§Ù†</h2>
                <div class="chart-container">
                    <div class="chart-title">Ø£ÙƒØ«Ø± 10 Ø³ÙƒØ§Ù† Ù…Ù† Ø­ÙŠØ« Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø±ÙƒØ¨Ø§Øª</div>
                    <canvas id="topResidentsChart"></canvas>
                </div>
                <div id="residents-table"></div>
            </div>

            <!-- Ø§Ù„Ù…ÙˆØ§Ù‚Ù -->
            <div id="parking" class="tab-content">
                <h2 style="color: #1e3a5f; margin-bottom: 20px;">ğŸ…¿ï¸ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…ÙˆØ§Ù‚Ù</h2>
                <div class="chart-container">
                    <div class="chart-title">ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…ÙˆØ§Ù‚Ù Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹</div>
                    <canvas id="parkingTypeChart"></canvas>
                </div>
                <div class="chart-container">
                    <div class="chart-title">Ø­Ø§Ù„Ø© Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…ÙˆØ§Ù‚Ù</div>
                    <canvas id="parkingStatusChart"></canvas>
                </div>
            </div>

            <!-- Ø§Ù„Ù…Ù„ØµÙ‚Ø§Øª -->
            <div id="stickers" class="tab-content">
                <h2 style="color: #1e3a5f; margin-bottom: 20px;">ğŸš— ØªÙ‚Ø±ÙŠØ± Ù…Ù„ØµÙ‚Ø§Øª Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª</h2>
                <div class="chart-container">
                    <div class="chart-title">Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ù„ØµÙ‚Ø§Øª</div>
                    <canvas id="stickersChart"></canvas>
                </div>
                <div id="stickers-stats"></div>
            </div>

            <button class="print-btn" onclick="window.print()">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ±</button>
        </div>
    </div>

    <script>
        let statsData = null;

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        async function loadData() {
            try {
                const response = await fetch('/api/comprehensive-statistics');
                const result = await response.json();
                
                if (result.success) {
                    statsData = result.data;
                    document.getElementById('loading').style.display = 'none';
                    renderAllCharts();
                } else {
                    showError('ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ' + result.error);
                }
            } catch (error) {
                showError('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ' + error.message);
            }
        }

        function showError(message) {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('error').textContent = message;
            document.getElementById('error').style.display = 'block';
        }

        function showTab(tabName) {
            // Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù…Ø­Ø¯Ø¯
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        function renderAllCharts() {
            if (!statsData) return;

            // ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ‚Ø±ÙŠØ±
            const now = new Date();
            document.getElementById('report-date').textContent = 
                `ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ‚Ø±ÙŠØ±: ${now.toLocaleDateString('ar-SA')} - ${now.toLocaleTimeString('ar-SA')}`;

            // Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„Ø£Ø¯Ø§Ø¡
            renderKPIs();

            // Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠØ©
            renderOverviewChart();
            renderBuildingsChart();
            renderTopBuildingsChart();
            renderUnitsChart();
            renderTopResidentsChart();
            renderParkingCharts();
            renderStickersChart();

            // Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„
            renderTables();
        }

        function renderKPIs() {
            const kpis = [
                { label: 'Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨Ø§Ù†ÙŠ', value: statsData.buildings.total_buildings, icon: 'ğŸ¢' },
                { label: 'Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙˆØ­Ø¯Ø§Øª', value: statsData.units.total_units, icon: 'ğŸ ' },
                { label: 'Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø³ÙƒØ§Ù†', value: statsData.residents.total_residents, icon: 'ğŸ‘¥' },
                { label: 'Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ÙˆØ§Ù‚Ù', value: statsData.parking.total_parking, icon: 'ğŸ…¿ï¸' },
                { label: 'Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ù„ØµÙ‚Ø§Øª', value: statsData.stickers.total_stickers, icon: 'ğŸš—' },
                { label: 'Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø¥Ø´ØºØ§Ù„', value: statsData.kpis.occupancy_rate + '%', icon: 'ğŸ“Š' },
                { label: 'Ù…Ø¹Ø¯Ù„ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…ÙˆØ§Ù‚Ù', value: statsData.kpis.parking_utilization + '%', icon: 'ğŸ“ˆ' },
                { label: 'Ù…Ø¹Ø¯Ù„ Ø§Ù„Ù…Ù„ØµÙ‚Ø§Øª/Ø³Ø§ÙƒÙ†', value: statsData.kpis.stickers_per_resident, icon: 'ğŸ¯' }
            ];

            const grid = document.getElementById('kpi-grid');
            grid.innerHTML = kpis.map(kpi => `
                <div class="kpi-card">
                    <div style="font-size: 3em;">${kpi.icon}</div>
                    <div class="kpi-value">${kpi.value.toLocaleString('ar-SA')}</div>
                    <div class="kpi-label">${kpi.label}</div>
                </div>
            `).join('');
        }

        function renderOverviewChart() {
            const ctx = document.getElementById('overviewChart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Ø§Ù„Ù…Ø¨Ø§Ù†ÙŠ', 'Ø§Ù„ÙˆØ­Ø¯Ø§Øª', 'Ø§Ù„Ø³ÙƒØ§Ù†', 'Ø§Ù„Ù…ÙˆØ§Ù‚Ù', 'Ø§Ù„Ù…Ù„ØµÙ‚Ø§Øª'],
                    datasets: [{
                        label: 'Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ',
                        data: [
                            statsData.buildings.total_buildings,
                            statsData.units.total_units,
                            statsData.residents.total_residents,
                            statsData.parking.total_parking,
                            statsData.stickers.total_stickers
                        ],
                        backgroundColor: [
                            'rgba(102, 126, 234, 0.8)',
                            'rgba(118, 75, 162, 0.8)',
                            'rgba(255, 99, 132, 0.8)',
                            'rgba(54, 162, 235, 0.8)',
                            'rgba(255, 206, 86, 0.8)'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        y: { beginAtZero: true }
                    }
                }
            });
        }

        function renderBuildingsChart() {
            const ctx = document.getElementById('buildingsChart').getContext('2d');
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Ø§Ù„Ø¹Ù…Ø§Ø±Ø§Øª', 'Ø§Ù„ÙÙ„Ù„'],
                    datasets: [{
                        data: [
                            statsData.buildings.apartments_count,
                            statsData.buildings.villas_count
                        ],
                        backgroundColor: [
                            'rgba(102, 126, 234, 0.8)',
                            'rgba(118, 75, 162, 0.8)'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { position: 'bottom' }
                    }
                }
            });
        }

        function renderTopBuildingsChart() {
            if (!statsData.top_buildings || statsData.top_buildings.length === 0) return;
            
            const ctx = document.getElementById('topBuildingsChart').getContext('2d');
            new Chart(ctx, {
                type: 'horizontalBar',
                data: {
                    labels: statsData.top_buildings.map(b => b.building_number),
                    datasets: [{
                        label: 'Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù„ØµÙ‚Ø§Øª',
                        data: statsData.top_buildings.map(b => b.sticker_count),
                        backgroundColor: 'rgba(102, 126, 234, 0.8)'
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        x: { beginAtZero: true }
                    }
                }
            });
        }

        function renderUnitsChart() {
            const ctx = document.getElementById('unitsChart').getContext('2d');
            new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: ['Ù…Ø´ØºÙˆÙ„Ø©', 'Ø´Ø§ØºØ±Ø©'],
                    datasets: [{
                        data: [
                            statsData.units.occupied_units,
                            statsData.units.vacant_units
                        ],
                        backgroundColor: [
                            'rgba(40, 167, 69, 0.8)',
                            'rgba(220, 53, 69, 0.8)'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { position: 'bottom' }
                    }
                }
            });

            // Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø¥Ø¶Ø§ÙÙŠØ©
            document.getElementById('units-stats').innerHTML = `
                <div class="chart-container">
                    <h3 style="color: #1e3a5f; margin-bottom: 15px;">Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ÙˆØ­Ø¯Ø§Øª</h3>
                    <table class="stats-table">
                        <tr>
                            <th>Ø§Ù„Ù…Ø¤Ø´Ø±</th>
                            <th>Ø§Ù„Ø¹Ø¯Ø¯</th>
                            <th>Ø§Ù„Ù†Ø³Ø¨Ø©</th>
                        </tr>
                        <tr>
                            <td>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙˆØ­Ø¯Ø§Øª</td>
                            <td>${statsData.units.total_units}</td>
                            <td>100%</td>
                        </tr>
                        <tr>
                            <td>Ø§Ù„ÙˆØ­Ø¯Ø§Øª Ø§Ù„Ù…Ø´ØºÙˆÙ„Ø©</td>
                            <td>${statsData.units.occupied_units}</td>
                            <td>${statsData.kpis.occupancy_rate}%</td>
                        </tr>
                        <tr>
                            <td>Ø§Ù„ÙˆØ­Ø¯Ø§Øª Ø§Ù„Ø´Ø§ØºØ±Ø©</td>
                            <td>${statsData.units.vacant_units}</td>
                            <td>${(100 - statsData.kpis.occupancy_rate).toFixed(1)}%</td>
                        </tr>
                    </table>
                </div>
            `;
        }

        function renderTopResidentsChart() {
            if (!statsData.top_residents || statsData.top_residents.length === 0) return;
            
            const ctx = document.getElementById('topResidentsChart').getContext('2d');
            new Chart(ctx, {
                type: 'horizontalBar',
                data: {
                    labels: statsData.top_residents.map(r => r.name),
                    datasets: [{
                        label: 'Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø±ÙƒØ¨Ø§Øª',
                        data: statsData.top_residents.map(r => r.vehicle_count),
                        backgroundColor: 'rgba(255, 99, 132, 0.8)'
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        x: { beginAtZero: true }
                    }
                }
            });
        }

        function renderParkingCharts() {
            // Ù†ÙˆØ¹ Ø§Ù„Ù…ÙˆØ§Ù‚Ù
            const ctx1 = document.getElementById('parkingTypeChart').getContext('2d');
            new Chart(ctx1, {
                type: 'doughnut',
                data: {
                    labels: ['Ø®Ø§Øµ', 'Ø¹Ø§Ù…', 'Ù…Ø¹Ø§Ù‚'],
                    datasets: [{
                        data: [
                            statsData.parking.private_parking,
                            statsData.parking.public_parking,
                            statsData.parking.disabled_parking
                        ],
                        backgroundColor: [
                            'rgba(102, 126, 234, 0.8)',
                            'rgba(54, 162, 235, 0.8)',
                            'rgba(255, 206, 86, 0.8)'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { position: 'bottom' }
                    }
                }
            });

            // Ø­Ø§Ù„Ø© Ø§Ù„Ù…ÙˆØ§Ù‚Ù
            const ctx2 = document.getElementById('parkingStatusChart').getContext('2d');
            new Chart(ctx2, {
                type: 'bar',
                data: {
                    labels: ['Ù…Ø´ØºÙˆÙ„', 'Ù…ØªØ§Ø­'],
                    datasets: [{
                        label: 'Ø¹Ø¯Ø¯ Ø§Ù„Ù…ÙˆØ§Ù‚Ù',
                        data: [
                            statsData.parking.occupied_parking,
                            statsData.parking.available_parking
                        ],
                        backgroundColor: [
                            'rgba(255, 99, 132, 0.8)',
                            'rgba(40, 167, 69, 0.8)'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        y: { beginAtZero: true }
                    }
                }
            });
        }

        function renderStickersChart() {
            const ctx = document.getElementById('stickersChart').getContext('2d');
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['ÙØ¹Ø§Ù„', 'Ù…Ù„ØºÙŠ'],
                    datasets: [{
                        data: [
                            statsData.stickers.active_stickers,
                            statsData.stickers.cancelled_stickers
                        ],
                        backgroundColor: [
                            'rgba(40, 167, 69, 0.8)',
                            'rgba(220, 53, 69, 0.8)'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { position: 'bottom' }
                    }
                }
            });

            // Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø¥Ø¶Ø§ÙÙŠØ©
            document.getElementById('stickers-stats').innerHTML = `
                <div class="chart-container">
                    <h3 style="color: #1e3a5f; margin-bottom: 15px;">Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ù„ØµÙ‚Ø§Øª</h3>
                    <table class="stats-table">
                        <tr>
                            <th>Ø§Ù„Ù…Ø¤Ø´Ø±</th>
                            <th>Ø§Ù„Ø¹Ø¯Ø¯</th>
                            <th>Ø§Ù„Ù†Ø³Ø¨Ø©</th>
                        </tr>
                        <tr>
                            <td>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ù„ØµÙ‚Ø§Øª</td>
                            <td>${statsData.stickers.total_stickers}</td>
                            <td>100%</td>
                        </tr>
                        <tr>
                            <td>Ø§Ù„Ù…Ù„ØµÙ‚Ø§Øª Ø§Ù„ÙØ¹Ø§Ù„Ø©</td>
                            <td>${statsData.stickers.active_stickers}</td>
                            <td>${statsData.kpis.active_sticker_rate}%</td>
                        </tr>
                        <tr>
                            <td>Ø§Ù„Ù…Ù„ØµÙ‚Ø§Øª Ø§Ù„Ù…Ù„ØºÙŠØ©</td>
                            <td>${statsData.stickers.cancelled_stickers}</td>
                            <td>${(100 - statsData.kpis.active_sticker_rate).toFixed(1)}%</td>
                        </tr>
                        <tr>
                            <td>Ù…Ø¹Ø¯Ù„ Ø§Ù„Ù…Ù„ØµÙ‚Ø§Øª Ù„ÙƒÙ„ Ø³Ø§ÙƒÙ†</td>
                            <td colspan="2">${statsData.kpis.stickers_per_resident}</td>
                        </tr>
                    </table>
                </div>
            `;
        }

        function renderTables() {
            // Ø¬Ø¯ÙˆÙ„ Ø£ÙƒØ«Ø± Ø§Ù„Ø³ÙƒØ§Ù† Ù…Ø±ÙƒØ¨Ø§Øª
            if (statsData.top_residents && statsData.top_residents.length > 0) {
                document.getElementById('residents-table').innerHTML = `
                    <div class="chart-container">
                        <h3 style="color: #1e3a5f; margin-bottom: 15px;">Ø£ÙƒØ«Ø± 10 Ø³ÙƒØ§Ù† Ù…Ù† Ø­ÙŠØ« Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø±ÙƒØ¨Ø§Øª</h3>
                        <table class="stats-table">
                            <tr>
                                <th>#</th>
                                <th>Ø§Ø³Ù… Ø§Ù„Ø³Ø§ÙƒÙ†</th>
                                <th>Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø±ÙƒØ¨Ø§Øª</th>
                            </tr>
                            ${statsData.top_residents.map((r, i) => `
                                <tr>
                                    <td>${i + 1}</td>
                                    <td>${r.name}</td>
                                    <td>${r.vehicle_count}</td>
                                </tr>
                            `).join('')}
                        </table>
                    </div>
                `;
            }
        }

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        window.addEventListener('load', loadData);
    </script>
</body>
</html>
