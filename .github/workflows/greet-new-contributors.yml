name: Greet New Contributors

on:
  issues:
    types: [opened]
  pull_request_target:
    types: [opened]

jobs:
  greet:
    runs-on: ubuntu-latest
    permissions:
      issues: write
      pull-requests: write
    
    steps:
      - name: Greet new contributors
        uses: actions/github-script@v7
        with:
          script: |
            const isNewContributor = context.payload.sender.type === 'User';
            
            // Check if this is an issue or PR
            const isIssue = !!context.payload.issue;
            const isPR = !!context.payload.pull_request;
            
            if (!isNewContributor) {
              console.log('Not a new contributor, skipping greeting');
              return;
            }
            
            // Get all issues and PRs from this user
            let userContributions = [];
            
            if (isIssue) {
              const issues = await github.rest.issues.listForRepo({
                owner: context.repo.owner,
                repo: context.repo.repo,
                creator: context.payload.sender.login,
                state: 'all'
              });
              userContributions = issues.data;
            } else if (isPR) {
              const prs = await github.rest.pulls.list({
                owner: context.repo.owner,
                repo: context.repo.repo,
                state: 'all'
              });
              userContributions = prs.data.filter(pr => pr.user.login === context.payload.sender.login);
            }
            
            // If this is their first contribution, greet them
            if (userContributions.length === 1) {
              let message = '';
              
              if (isIssue) {
                message = `## ğŸ‰ Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ! Welcome!

Ø´ÙƒØ±Ø§Ù‹ Ù„Ùƒ Ø¹Ù„Ù‰ ÙØªØ­ Ø£ÙˆÙ„ Ù‚Ø¶ÙŠØ© ÙÙŠ Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¥Ø³ÙƒØ§Ù† Ø§Ù„Ø¬Ø§Ù…Ø¹ÙŠ!
Thank you for opening your first issue in the University Housing Management System!

### Ù…Ø§Ø°Ø§ Ø¨Ø¹Ø¯ØŸ What's next?

- Ø³ÙŠÙ‚ÙˆÙ… ÙØ±ÙŠÙ‚Ù†Ø§ Ø¨Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ù‚Ø¶ÙŠØ© ÙÙŠ Ø£Ù‚Ø±Ø¨ ÙˆÙ‚Øª Ù…Ù…ÙƒÙ†
  Our team will review your issue as soon as possible
  
- ÙŠÙ…ÙƒÙ†Ùƒ Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª Ù…Ù† Ø®Ù„Ø§Ù„ Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø©
  You can follow updates on this page
  
- Ø¥Ø°Ø§ ÙƒÙ†Øª ØªØ±ØºØ¨ ÙÙŠ Ø§Ù„Ø¹Ù…Ù„ Ø¹Ù„Ù‰ Ø­Ù„ Ù‡Ø°Ù‡ Ø§Ù„Ù‚Ø¶ÙŠØ©ØŒ ÙÙ„Ø§ ØªØªØ±Ø¯Ø¯ ÙÙŠ Ø¥Ø®Ø¨Ø§Ø±Ù†Ø§!
  If you'd like to work on solving this issue, please let us know!

### Ù…ÙˆØ§Ø±Ø¯ Ù…ÙÙŠØ¯Ø© - Helpful Resources

- [Ø¯Ù„ÙŠÙ„ Ø§Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ø³Ø±ÙŠØ¹ - Quick Start Guide](https://github.com/${context.repo.owner}/${context.repo.repo}/blob/main/QUICK_START.md)
- [Ø¯Ù„ÙŠÙ„ Ø§Ù„ØªØ·ÙˆÙŠØ± - Development Guide](https://github.com/${context.repo.owner}/${context.repo.repo}/blob/main/DEVELOPMENT.md)
- [Ø¥Ø±Ø´Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø³Ø§Ù‡Ù…Ø© - Contribution Guidelines](https://github.com/${context.repo.owner}/${context.repo.repo}/blob/main/.github/copilot-instructions.md)

Ù†Ø­Ù† Ø³Ø¹Ø¯Ø§Ø¡ Ø¨Ø§Ù†Ø¶Ù…Ø§Ù…Ùƒ Ø¥Ù„Ù‰ Ù…Ø¬ØªÙ…Ø¹Ù†Ø§! ğŸŒŸ
We're happy to have you in our community! ğŸŒŸ`;
              } else if (isPR) {
                message = `## ğŸ‰ Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ! Welcome!

Ø´ÙƒØ±Ø§Ù‹ Ù„Ùƒ Ø¹Ù„Ù‰ ÙØªØ­ Ø£ÙˆÙ„ Ø·Ù„Ø¨ Ø³Ø­Ø¨ ÙÙŠ Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¥Ø³ÙƒØ§Ù† Ø§Ù„Ø¬Ø§Ù…Ø¹ÙŠ!
Thank you for opening your first pull request in the University Housing Management System!

### Ù…Ø§Ø°Ø§ Ø¨Ø¹Ø¯ØŸ What's next?

- Ø³ÙŠÙ‚ÙˆÙ… ÙØ±ÙŠÙ‚Ù†Ø§ Ø¨Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª Ø§Ù„Ø®Ø§ØµØ© Ø¨Ùƒ
  Our team will review your changes
  
- ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª ØªÙ…Ø± Ø¨Ù†Ø¬Ø§Ø­
  Make sure all tests pass successfully
  
- Ù†Ø­Ù† Ù†Ù‚Ø¯Ø± Ø§Ù„ÙˆÙ‚Øª ÙˆØ§Ù„Ø¬Ù‡Ø¯ Ø§Ù„Ø°ÙŠ Ø¨Ø°Ù„ØªÙ‡!
  We appreciate the time and effort you've put in!

### Ù†ØµØ§Ø¦Ø­ Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© - Review Tips

âœ… ØªØ£ÙƒØ¯ Ù…Ù† Ø§ØªØ¨Ø§Ø¹ Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„ÙƒÙˆØ¯ ÙÙŠ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹
   Make sure to follow the project's code standards

âœ… Ø£Ø¶Ù Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø¥Ø°Ø§ ÙƒØ§Ù† Ø°Ù„Ùƒ Ù…Ù†Ø§Ø³Ø¨Ø§Ù‹
   Add tests if applicable

âœ… Ù‚Ù… Ø¨ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙˆØ«ÙŠÙ‚ Ø¥Ø°Ø§ Ù„Ø²Ù… Ø§Ù„Ø£Ù…Ø±
   Update documentation if necessary

### Ù…ÙˆØ§Ø±Ø¯ Ù…ÙÙŠØ¯Ø© - Helpful Resources

- [Ø¯Ù„ÙŠÙ„ Ø§Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ø³Ø±ÙŠØ¹ - Quick Start Guide](https://github.com/${context.repo.owner}/${context.repo.repo}/blob/main/QUICK_START.md)
- [Ø¯Ù„ÙŠÙ„ Ø§Ù„ØªØ·ÙˆÙŠØ± - Development Guide](https://github.com/${context.repo.owner}/${context.repo.repo}/blob/main/DEVELOPMENT.md)
- [ÙƒÙŠÙÙŠØ© ØªØ´ØºÙŠÙ„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª - How to Run Tests](https://github.com/${context.repo.owner}/${context.repo.repo}/blob/main/DEVELOPMENT.md#testing)

Ù†Ø­Ù† Ù…ØªØ­Ù…Ø³ÙˆÙ† Ù„Ø±Ø¤ÙŠØ© Ù…Ø³Ø§Ù‡Ù…ØªÙƒ! ğŸš€
We're excited to see your contribution! ğŸš€`;
              }
              
              if (message) {
                if (isIssue) {
                  await github.rest.issues.createComment({
                    owner: context.repo.owner,
                    repo: context.repo.repo,
                    issue_number: context.payload.issue.number,
                    body: message
                  });
                } else if (isPR) {
                  await github.rest.issues.createComment({
                    owner: context.repo.owner,
                    repo: context.repo.repo,
                    issue_number: context.payload.pull_request.number,
                    body: message
                  });
                }
                
                console.log('Greeted new contributor!');
              }
            }
